<!-- 内容区 -->
{if condition="$data_info['firm_name']"}
<div class="layui-tab layui-tab-brief j-no-color">
  <ul class="layui-tab-title">
    <li class="layui-this">编辑</li></ul>
</div>
<div class="j-details-from">
  <form class="layui-form j-long-words" action="{:url('edit')}" method="post" id="addForm">
    <fieldset class="layui-elem-field layui-field-title j-size-color" style="margin-top: 20px;">
      <legend>基础信息</legend></fieldset>
    <div class="layui-form-item">
      <label class="layui-form-label">
        <i class="red">*</i>企业名称：</label>
      <div class="layui-input-block">
        <div class="j-words-border">{$data_info['firm_name']}</div></div>
    </div>
    <div class="layui-form-item">
      <div class="layui-inline">
        <label class="layui-form-label">
          <i class="red">*</i>联系人姓名：</label>
        <div class="layui-input-inline j-name">
          <input type="text" name="firm_manager" lay-verify="required" value="{$data_info['firm_manager']}" placeholder="请输入联系人姓名" lay-verType="tips" autocomplete="off" class="layui-input"></div>
      </div>
    </div>
    <div class="layui-form-item">
      <div class="layui-inline">
        <label class="layui-form-label">
          <i class="red">*</i>联系人电话：</label>
        <div class="layui-input-inline j-name">
          <input type="tel" name="firm_tel" value="{$data_info['firm_tel']}" lay-verify="required|phone" placeholder="请输入联系人电话" lay-verType="tips" autocomplete="off" class="layui-input"></div>
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">社会信用代码：</label>
      <div class="layui-input-block">
        <div class="j-words-border">{$data_info['firm_credit_code']}</div></div>
    </div>
    <div class="layui-form-item">
      <div class="layui-inline">
        <label class="layui-form-label">所属行业：</label>
        <div class="layui-input-inline j-name">
          <select name="firm_industry_type" lay-verify="required"  lay-verType="tips" class="field-cid" type="select">
                <option value="">请选择状态</option>
                {volist name="params['firm_industry_type']" id="v"}
                <option value="{$key}" {if condition="$key == $data_info['firm_industry_type']"}selected{/if}>{$v}</option>
                {/volist}
             </select>
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">注册资金：</label>
      <div class="layui-input-block">
        <div class="j-words-border">{$data_info['firm_registered_capital']}</div></div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">法人姓名：</label>
      <div class="layui-input-block">
        <div class="j-words-border">{$data_info['firm_legaler']}</div></div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">成立日期：</label>
      <div class="layui-input-block">
        <div class="j-words-border">{$data_info['firm_established_time']}</div></div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">注册地址：</label>
      <div class="layui-input-block">
        <div class="j-words-border">{$data_info['firm_registered_address']}</div></div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">经营范围：</label>
      <div class="layui-input-block">
        <div class="j-words-border">{$data_info['firm_scope']}</div></div>
    </div>
    <div class="layui-form-item j-positions-size">
      <div class="layui-inline">
        <label class="layui-form-label">营业执照：</label>
        <div class="layui-input-block j-uplode-block">
          <div class="upload_img_list j-viewer-img">
            {volist name="data_info['firm_imgs']" id="v"}
            <dd class="item_img" id="SiteImg">
              <img src="{$v['file']}" class="img">
            </dd>
            {/volist}
            <!-- <dd class="item_img" id="SiteImg">
              <img src="/upload/ban/image/20190822/0b3e8ba58e28639abd9d080b07decd5e.png" class="img">
            </dd> -->
          </div>
        </div>
      </div>
    </div>
    <div class="layui-form-item j-positions-size">
      <div class="layui-inline">
        <label class="layui-form-label">
          <i class="red">*</i>入驻合同：</label>
        <div class="layui-input-block j-uplode-block" lay-verify="validateMoney" lay-vertype="tips">
          <div class="j-uplode-icon fl">
            <i class="layui-icon  layui-icon-add-1"></i>
            <button type="button" class="layui-btn layui-btn-primary" id="upload_img1">上传图片</button></div>
          <div id="upload_img_list1" class="upload_img_list j-viewer-img">
            {volist name="$data_info['imgs']" id="v"}
          
          <dd class="item_img" id="">
            <div class="operate">
              <i  class="layui-icon-close-fill layui-icon"></i>
            </div>
            <img src="{$v['file']}" class="img" ><input type="hidden" name="file[]" value="{$v['id']}" />
          </dd>
          
          {/volist}
            
          </div>
        </div>
      </div>
    </div>
    <div class="layui-form-item">
      <div class="layui-col-md8">
        <label class="layui-form-label">备注：</label>
        <div class="layui-input-block">
          <input type="text" name="firm_remark" value="{$data_info['firm_remark']}" placeholder="备注描述..." lay-vertype="tips" autocomplete="off" class="layui-input"></div>
      </div>
    </div>
    <input type="hidden" name="firm_id" value="{$data_info['firm_id']}">
    <input type="hidden" name="id" value="{$data_info['id']}">
    <fieldset class="layui-elem-field layui-field-title j-size-color" style="margin-top: 20px;">
      <legend>员工信息</legend></fieldset>
    <table id="dataTable" lay-filter='dataTable'></table>
    <div class="layui-form-item">
      <div class="layui-input-blocks">
        <button type="reset" class="layui-btn layui-btn-primary">取消</button>
        <button class="layui-btn layui-btn-normal" lay-submit="" lay-filter="formSubmit">确定</button></div>
    </div>
    </from>
</div>
<!-- 内容区 -->


{else /}

<!-- 个人内容区 -->
<div class="layui-tab layui-tab-brief j-no-color">
  <ul class="layui-tab-title">
    <li class="layui-this">编辑</li></ul>
</div>
<div class="j-details-from">
  <form class="layui-form j-long-words" action="{:url('edit')}" method="post" id="addForm">
    <fieldset class="layui-elem-field layui-field-title j-size-color" style="margin-top: 20px;">
      <legend>个人信息</legend></fieldset>
    <div class="layui-form-item">
      <div class="layui-inline">
        <label class="layui-form-label">
          <i class="red">*</i>姓名：</label>
        <div class="layui-input-inline j-name">
          <input type="text" name="member_name" lay-verify="required" value="{$data_info['member_name']}" placeholder="请输入姓名" lay-verType="tips" autocomplete="off" class="layui-input"></div>
      </div>
    </div>
    <div class="layui-form-item">
      <div class="layui-inline">
        <label class="layui-form-label">
          <i class="red">*</i>电话：</label>
        <div class="layui-input-inline j-name">
          <input type="tel" name="member_tel" lay-verify="required|phone" value="{$data_info['member_tel']}" placeholder="请输入电话" lay-verType="tips" autocomplete="off" class="layui-input"></div>
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">性别：</label>
      <div class="layui-input-block">
        <div class="j-words-border">{if condition="$data_info['member_sex']"}男{else /}女{/if}</div></div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">身份证号：</label>
      <div class="layui-input-block">
        <div class="j-words-border">{$data_info['member_card']}</div></div>
    </div>
    <div class="layui-form-item">
      <div class="layui-col-md8">
        <label class="layui-form-label">备注：</label>
        <div class="layui-input-block">
          <input type="text" name="member_remark" value="{$data_info['member_remark']}" placeholder="" lay-vertype="tips" autocomplete="off" class="layui-input">
        </div>
      </div>
    </div>
    <fieldset class="layui-elem-field layui-field-title j-size-color" style="margin-top: 20px;">
      <legend>合同信息</legend></fieldset>
    <div class="layui-form-item j-positions-size">
      <div class="layui-inline">
        <label class="layui-form-label">
          <i class="red">*</i>合同：</label>
        <div class="layui-input-block j-uplode-block" lay-verify="validateMoney" lay-vertype="tips">
          <div class="j-uplode-icon fl">
            <i class="layui-icon  layui-icon-add-1"></i>
            <button type="button" class="layui-btn layui-btn-primary" id="upload_img1">上传图片</button></div>
          <div id="upload_img_list1" class="upload_img_list j-viewer-img">
            <div id="upload_img_list1" class="upload_img_list j-viewer-img">
            {volist name="$data_info['imgs']" id="v"}
          
          <dd class="item_img" id="">
            <div class="operate">
              <i  class="layui-icon-close-fill layui-icon"></i>
            </div>
            <img src="{$v['file']}" class="img" ><input type="hidden" name="file[]" value="{$v['id']}" />
          </dd>
          
          {/volist}
          </div>
          </div>
        </div>
      </div>
    </div>
    <input type="hidden" name="member_id" value="{$data_info['member_id']}">
    <input type="hidden" name="id" value="{$data_info['id']}">
    <div class="layui-form-item">
      <div class="layui-input-block">
        <a href="{:url('index')}" class="layui-btn layui-btn-primary">取消</a>
        <button class="layui-btn layui-btn-normal" lay-submit="" lay-filter="formSubmit">确定</button></div>
    </div>
    </from>
</div>
{/if}
<!-- 个人内容区 -->



<script type="text/html" title="操作按钮模板" id="buttonTpl">
		<div class="j-operation-box">
			<span class="j-enterprise"><i class="layui-icon iconfont layui-icon-username"></i>企业管理员</span>
		</div>
</script>
{include file="system@block/layui" /}
<script>   
		 /*上传参数设定*/
		var upurl = "{:url('system/Api/upload')}?input=BusinessLicense&group=project&water=no"; //上传合同
		var duotu = true; //是否为多图上传true false
		   layui.use(['jquery', 'laydate', 'upload', 'form', 'layedit','table'], function() {
		    var laydate = layui.laydate,
		      $ = layui.$,
		      upload = layui.upload,
			  table = layui.table,
			  layedit = layui.layedit,
		      form = layui.form; 
               //场地图片
              upload.render({
                elem: '#upload_img1',
                url: upurl,
                size: 1024,
                multiple: duotu,
                field: 'BusinessLicense',
                before: function(obj) {
                  layer.msg('图片上传中...', {
                    icon: 16,
                    shade: 0.01,
                    time: 0
                  })
                },
                done: function(res) {
                  layer.close(layer.msg()); //关闭上传提示窗口
                  if (duotu == true) {
                    //调用多图上传方法,其中res.imgid为后台返回的一个随机数字
                    $('#upload_img_list1').append('<dd class="item_img" id="' + res.data.name +
                      '"><div class="operate"><i  class="layui-icon-close-fill layui-icon"></i></div><img src="' + res.data.file +
                      '" class="img" ><input type="hidden" name="file[]" value="' + res.data.id + '" /></dd>');
                  } else {
                    //调用单图上传方法,其中res.imgid为后台返回的一个随机数字
                    $('#upload_img_list1').html('<dd class="item_img" id="' + res.data.name +
                      '"><div class="operate"><i  class="layui-icon-close-fill layui-icon"></i></div><img src="' + res.data.file +
                      '" class="img" ><input type="hidden" name="file[]" value="' + res.data.id + '" /></dd>');
                  }
                }
              })
              /*
              删除上传图片
              */
              $(document).on("click", ".upload_img_list dd i", function() {
                $(this).parents("dd").remove();
              })
			  //自定义验证规则
				form.verify({
					validateMoney: function (value) {
						var img=$.trim($("#upload_img_list1").html());
						if(img=="")
						{
							return '请提交入驻合同！';
						}
					}
				});
			  //表格选择入驻人员
			  table.render({
			      elem: '#dataTable'
			      ,url: '{:url('member/index')}?firm_id={$data_info['firm_id']}' //数据接口
			      ,page: true //开启分页
			  	//,height: 'full-280'
			      ,skin: 'line'
			      //,even: false
			      ,limit: 10
			      ,text: {
			          none : '暂无相关数据'
			      }
			      ,cols: [[ //表头
			      	   {field: 'member_name', align:'center',minWidth:100, title: '姓名'}
			          ,{field: 'member_tel', align:'center',minWidth:100, title: '电话'}
			          ,{field: 'member_post', align:'center',minWidth:100, title: '职位'}
					       ,{field: 'member_department', align:'center',minWidth:100, title: '部门'},
  					     ,{field: 'member_sex', align:'center',minWidth:100, title: '性别', templet: function(d) {
                    return d.member_sex?'男':'女';
                }}
                 ,{field: 'member_card', align:'center',minWidth:100, title: '身份证号'}
  					     ,{field: 'member_type', align:'center',minWidth:100, title: '类型', templet: function(d) {
                    return params.member_type[d.member_type];
                }}

			          // ,{title: 'member_type',align:'center', minWidth:280, templet: '#buttonTpl', width: 280,fixed:'right'}
			      ]]
			  });
		  });
		  
	</script>