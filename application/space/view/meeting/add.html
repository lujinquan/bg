<div class="layui-tab layui-tab-brief j-no-color">
  <ul class="layui-tab-title">
    <li class="layui-this">新增会议室</li>
  </ul>
</div>
<form class="layui-form j-long-words  j-top-margin" action="{:url()}" method="post" id="addForm">
  <div class="layui-form-item">
        <div class="layui-inline">
          <label class="layui-form-label"><i class="red">*</i>会议室名称：</label>
          <div class="layui-input-inline j-name">
            <input type="text" name="meet_name" lay-verify="required" placeholder="请输入" lay-verType="tips" autocomplete="off" class="layui-input">
          </div>
        </div>
     </div>
  <div class="layui-form-item">
      <div class="layui-inline">
        <label class="layui-form-label"><i class="red">*</i>所属楼宇：</label>
        <div class="layui-input-inline">
          <select name="ban_id" lay-verify="required" lay-verType="tips" class="field-cid" type="select">
              <option value="">请选择</option>
              {volist name="banArr" id="v"}
              <option value="{$v['ban_id']}">{$v['ban_name']}</option>
              {/volist}
          </select>
        </div>
      </div>
  </div>
 <!-- 多楼层选择 <div class="layui-form-item">
        <label class="layui-form-label"><i class="red">*</i>所属楼层：</label>
        <div class="layui-input-block" id="floor_number"  lay-verType="tips"></div>
  </div> -->
  <div class="layui-form-item">
      <div class="layui-inline">
        <label class="layui-form-label"><i class="red">*</i>所属楼层：</label>
        <div class="layui-input-inline">
          <select name="floor_number" class="field-cid" type="select">
              <option value="">请选择</option>
              <option value="1">1楼</option>
              <option value="2">2楼</option>
              <option value="3">3楼</option>
              <option value="4">4楼</option>
              <option value="5">5楼</option>
              <option value="6">6楼</option>
              <option value="7">7楼</option>
              <option value="8">8楼</option>
          </select>
        </div>
      </div>
  </div>
   <div class="layui-form-item j-positions-size">
      <div class="layui-inline">
        <label class="layui-form-label"><i class="red">*</i>会议室图片：</label>
        <div class="layui-input-block j-uplode-block" lay-verify="conferenceroom" lay-vertype="tips">
           <div class="j-uplode-icon fl">
             <i class="layui-icon  layui-icon-add-1"></i>
             <button type="button" class="layui-btn layui-btn-primary" id="upload_img1">上传图片</button>
           </div>
           <div id="upload_img_list1" class="upload_img_list j-viewer-img">
			   
		   </div>
        </div>
      </div>
  </div> 
    <div class="layui-form-item">
        <div class="layui-inline">
          <label class="layui-form-label"><i class="red">*</i>可预约时段：</label>
          <div class="layui-input-inline" style="width: 190px;">
      <input type="text" name="order_start_time" class="layui-input" lay-verify="required" lay-verType="tips" id="test14" placeholder="请选择">
      </div>
      <div class="layui-form-mid">-</div>
      <div class="layui-input-inline" style="width: 190px;">
      <input type="text" name="order_end_time" class="layui-input" lay-verify="required" lay-verType="tips" id="test15" placeholder="请选择">
      </div>
        </div>
     </div>
     <div class="layui-form-item">
        <div class="layui-inline">
          <label class="layui-form-label"><i class="red">*</i>租赁单价：</label>
          <div class="layui-input-inline">
            <input type="number" name="meet_unit_price" lay-verify="required|number" placeholder="请输入单价" lay-vertype="tips" autocomplete="off" class="layui-input j-explain-inputs">
      <b class="j-explain-name">元/0.5h</b>
          </div>
        </div>
     </div>
	 <div class="layui-form-item">
	     <div class="layui-inline">
	       <label class="layui-form-label"><i class="red">*</i>容纳人数：</label>
	       <div class="layui-input-inline">
	         <input type="number" name="meet_volume" lay-verify="required|number"  placeholder="请输入容纳人数" lay-verType="tips" autocomplete="off" class="layui-input j-explain-input">
			 <b class="j-explain-name">人</b>
	       </div>
	     </div>
	</div>
   <div class="layui-form-item">
       <div class="layui-col-md8">
         <label class="layui-form-label"><i class="red">*</i>门禁设备：</label>
		 <div class="layui-input-block" id="door_equipment"  lay-verType="tips"></div>
        <!-- <div class="layui-input-block j-input-facilities">
			 <input type="checkbox" name="facility_ids[]" value="1" lay-verify="require|choiceone"  lay-verType="tips" lay-skin="primary" title="设备1">
			 <input type="checkbox" name="facility_ids[]" value="2" lay-verify="require|choiceone"  lay-verType="tips" lay-skin="primary" title="设备2">
			 <input type="checkbox" name="facility_ids[]" value="3" lay-verify="require|choiceone"  lay-verType="tips" lay-skin="primary" title="设备3">
         </div> -->
       </div>
   </div>
   <div class="layui-form-item">
    <div class="layui-col-md8">
         <label class="layui-form-label"><i class="red">*</i>路径门禁：</label>
         <div class="layui-input-block j-input-route">
           <input type="checkbox" name="door_ids[]" value="1" lay-verify="require|choiceroute" lay-verType="tips" lay-skin="primary" title="门禁1">
       <input type="checkbox" name="door_ids[]" value="2" lay-verify="require|choiceroute" lay-verType="tips" lay-skin="primary" title="门禁2">
       <input type="checkbox" name="door_ids[]" value="3" lay-verify="require|choiceroute" lay-verType="tips" lay-skin="primary" title="门禁3">
         </div>
    </div>
    </div>
    <div class="layui-form-item">
       <div class="layui-col-md6">
         <label class="layui-form-label">选择设备：</label>
         <div class="layui-input-block j-indent-equipment">
         <input type="checkbox" name="item_ids[]" value="1" lay-verify="require|equipment" lay-verType="tips" lay-skin="primary" title="WI-FI">
         <input type="checkbox" name="item_ids[]" value="2" lay-verify="require|equipment" lay-verType="tips" lay-skin="primary" title="投影仪">
         <input type="checkbox" name="item_ids[]" value="3" lay-verify="require|equipment" lay-verType="tips" lay-skin="primary" title="智能电视">
         <input type="checkbox" name="item_ids[]" value="4" lay-verify="require|equipment" lay-verType="tips" lay-skin="primary" title="电脑">
         <input type="checkbox" name="item_ids[]" value="5" lay-verify="require|equipment" lay-verType="tips" lay-skin="primary" title="白板">
         <input type="checkbox" name="item_ids[]" value="6" lay-verify="require|equipment" lay-verType="tips" lay-skin="primary" title="杯子">
         <input type="checkbox" name="item_ids[]" value="7" lay-verify="require|equipment" lay-verType="tips" lay-skin="primary" title="饮水机">
         <input type="checkbox" name="item_ids[]" value="8" lay-verify="require|equipment" lay-verType="tips" lay-skin="primary" title="沙发">
         <input type="checkbox" name="item_ids[]" value="9" lay-verify="require|equipment" lay-verType="tips" lay-skin="primary" title="卫生间">
         <input type="checkbox" name="item_ids[]" value="10" lay-verify="require|equipment" lay-verType="tips" lay-skin="primary" title="远程会议">
         </div>
       </div>
   </div>
   <div class="layui-form-item">
        <div class="layui-inline">
          <label class="layui-form-label">面积：</label>
          <div class="layui-input-inline">
            <input type="number" name="meet_area"   placeholder="请输入面积" lay-vertype="tips" autocomplete="off" class="layui-input j-explain-input">
      <b class="j-explain-name">m²</b>
          </div>
        </div>
     </div>
   <div class="layui-form-item">
    <div class="layui-col-md8">
      <label class="layui-form-label">会议室介绍：</label>
      <div class="layui-input-block">
        <input type="text" name="meet_remark" placeholder="备注描述..." lay-vertype="tips" autocomplete="off" class="layui-input">
      </div>
    </div>
  </div>
     {:token()}
    <div class="layui-form-item j-top-formmargin">
        <div class="layui-input-block">
          <a href="javascript:history.go(-1)" class="layui-btn layui-btn-primary">取消</a>
          <button class="layui-btn layui-btn-normal" lay-submit="" lay-filter="formSubmit">确定</button>
        </div>
     </div>
</form>
{include file="system@block/layui" /}
<script>
  var tagData = [{"id":1,"name":"1楼"},{"id":2,"name":"2楼"},{"id":3,"name":"3楼"},{"id":4,"name":"4楼"},{"id":5,"name":"5楼"},{"id":6,"name":"6楼"}];  
  var doorData = [{"id":1,"name":"门禁1"},{"id":2,"name":"门禁2"},{"id":3,"name":"门禁3"},{"id":4,"name":"门禁4"},{"id":5,"name":"门禁5"},{"id":6,"name":"门禁6"}]; 
  /*上传参数设定*/
  var upurl = "{:url('system/Api/upload')}?input=MeetImg&group=ban&water=no"; //上传楼层平面图
  var duotu = true; //是否为多图上传true false
   layui.use(['jquery', 'laydate', 'upload', 'form','selectN','selectM'], function() {
    var laydate = layui.laydate,
      $ = layui.$,
      upload = layui.upload,
      form = layui.form,
      selectN = layui.selectN,
      selectM = layui.selectM; 
	  //自定义验证规则
       form.verify({

			choiceroute: function () {
			   if ($("input[name='door_ids[]']:checked").length == 0) {
					 return '请选择路径门禁';
			   } 
			  
			} ,

			//验证会议室图片
			conferenceroom: function () {
				var img=$.trim($(".j-viewer-img").html());
				if(img=="")
				{
					return '请提交会议室图片！';
				}
			}
			
		});
    //场地图片
    upload.render({
      elem: '#upload_img1',
      url: upurl,
      size: 1024,
      multiple: duotu,
      field: 'MeetImg',
      before: function(obj) {
        layer.msg('图片上传中...', {
          icon: 16,
          shade: 0.01,
          time: 0
        })
      },
      done: function(res) {
        layer.close(layer.msg()); //关闭上传提示窗口
        if (duotu == true) {
          //调用多图上传方法,其中res.imgid为后台返回的一个随机数字
          $('#upload_img_list1').append('<dd class="item_img" id="' + res.data.name +
            '"><div class="operate"><i  class="layui-icon-close-fill layui-icon"></i></div><img src="' + res.data.file +
            '" class="img" ><input type="hidden" name="file[]" value="' + res.data.id + '" /></dd>');
        } else {
          //调用单图上传方法,其中res.imgid为后台返回的一个随机数字
          $('#upload_img_list1').html('<dd class="item_img" id="' + res.data.name +
            '"><div class="operate"><i  class="layui-icon-close-fill layui-icon"></i></div><img src="' + res.data.file +
            '" class="img" ><input type="hidden" name="file" value="' + res.data.id + '" /></dd>');
        }
      }
    })
    /*
    删除上传图片
    */
    $(document).on("click", ".upload_img_list dd i", function() {
      $(this).parents("dd").remove();
    })
    //多选标签-所属楼层
    var tagIns1 = selectM({
      //元素容器【必填】
      elem: '#floor_number'
      //候选数据【必填】
      ,data: tagData
      //,max:10
      ,width:400
      //添加验证
      ,verify:'required'      
    }); 
	//多选标签-门禁设备
	var tagIns2 = selectM({
	  //元素容器【必填】
	  elem: '#door_equipment'
	  //候选数据【必填】
	  ,data: doorData
	  //,max:10
	  ,width:400
	  //添加验证
	  ,verify:'required'      
	}); 
     //时间选择器
      laydate.render({
		  elem: '#test14'
		  ,type: 'time'
		  ,format: 'HH:mm'
      });
      laydate.render({
		elem: '#test15'
		,type: 'time'
		,format: 'HH:mm'
	  });
});
  //图片查看
  /* $(".j-viewer-img").on("click",function(){
    $(this).viewer({
      url: 'data-original',
     });
  }) */
  
</script>
